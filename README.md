# q1hyUnlock
for some disscutions of ICCMAX and vddq unlocking on q1hy modt

## ICCMAX电流墙
主板在启动的初始化阶段禁用了VR Current Limit选项，所以即使用AMIBCP或者uefi tool修改了对应
的数值，在启动阶段也不会生效。

主板在bios初始化阶段（DXE）会对CPU内部msr寄存器进行读写操作以用于初始化CPU，其中
就包括了设置ICCMAX电流墙。

具体实现如下：
    
写入：   
wrmsr 0x150 0x8000001700000280

读取：  
wrmsr 0x150 0x8000001600000000   
rdmsr 0x150

寄存器地址为0x150，设定值为十六进制的0x280，转换为10进制为640，电流墙为其1/4即160A

### 破解思路  
方法1. 找到主板禁用VR Current Limit选项的代码，用IDA跳过代码  
方法2. 在CPUDXE阶段插入上述指令使其每次启动都能执行，十六进制代码如下  
BA 17 00 00 80 B8 20 03 00 00 B9 50 01 00 00 0F 30

## 内存VDDQ电压解锁
此系列modt主板使用的内存PWM芯片为APW8828  
电路图如下  
![电路图](pics/电路图.png  ) 
输出电压是通过调节FB引脚上的Rtop和Rgnd来实现的  
![电路图](pics/电压计算公式.png  ) 


这里补一张电路图实测  
![电路图](pics/主板电路及电压实测.jpg  )   

由于出厂时少了一组三极管和电阻，结合电压计算公式带入Rtop和Rgnd，在3号三极管截至的情况下，最高电压为1.39V，
即bios内存电压选项中的1.35V；当3号三极管导通，Rtop整体阻值降低，内存电压也来到1.25V，即
bios内存电压选项的1.23V.


### 破解思路  
#### 方法1. 
修改配置电阻Rtop的阻值，将其从1.55K欧姆调整为1.9K欧姆，则可实现1.55v的vddq，且不需要修改bios选项,此时bios内存vddq电压的1.35V即为1.55V.  
![电路图](pics/Rtop.jpg  )     
#### 方法2.
补齐三极管和对应的电阻，电阻阻值未知，但从分析来看可能也是14K欧姆的；此时方法1中的电阻应该也要改，不然最大电压可能还是1.35V（**每个三极管导通的作用像是往Rtop并联电阻，会导致原来的1.23v档实际vddq电压低于1.2v**）  
另外还有个元件在空的三极管左边，不知道是电阻还是滤波电容。  
![电路图](pics/三极管及电阻焊盘.jpg  )   
此方法需要修改bios调出隐藏的VDDQ 1.5V和1.6V选项。  
bios文件可以找b站用户：**[just我觉得](https://space.bilibili.com/104188156 "just我觉得")。** 



或者不选择调出隐藏的VDDQ 1.5V和1.6V选项，  
用IDA修改bios下的turbopei EFI文件，将case1的00改成01，将case2的01改成10，则补齐三极管和电阻后可原本的1.23V和1.35V即为1.35V和1.5V的VDDQ    
![电路图](pics/TurboPei_fix.png  )  

**重要：方法2修改前需要将内存电压选项设置为最大值，同时内存频率降低至2400Mhz，以防止内存VDDQ电压过低导致无法过内存；修改后先拆除内存和硬盘再上电，用万用表测量vddq电压在合理范围（1.2v-1.6v）内再插内存，vddq电压在Rtop一端能测量到**


